<!doctype html>
<html lang="pl">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="dark">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap"
    rel="stylesheet">
  <title>Wysi≈Çki Labana ‚Äî Trening G≈Çosu</title>
  <style>
    /* ‚îÄ‚îÄ‚îÄ RESET & VARIABLES ‚îÄ‚îÄ‚îÄ */
    :root {
      --color-bg: #0e0e12;
      --color-surface: #16161c;
      --color-card: #1e1e28;
      --color-card-hi: #2a2a38;
      --color-border: #2e2e3e;
      --color-text: #e2e0e8;
      --color-muted: #7a7888;
      --color-accent: #c084fc;
      --color-gold: #fbbf24;
      --color-green: #4ade80;
      --color-red: #f87171;
      --color-blue: #60a5fa;
      --color-orange: #fb923c;
      /* axes colours */
      --ax-ciezar: #f472b6;
      /* pink  */
      --ax-czas: #60a5fa;
      /* blue  */
      --ax-prz: #a78bfa;
      /* violet */
      --radius: 14px;
      --radius-sm: 8px;
    }

    /* Pico overrides ‚Äî lock to dark */
    html {
      background: var(--color-bg);
    }

    body {
      font-family: 'Inter', sans-serif;
      color: var(--color-text);
      background: var(--color-bg);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* kill pico card defaults */
    article {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      box-shadow: 0 4px 24px rgba(0, 0, 0, .35);
    }

    button {
      font-family: inherit;
    }

    /* pico nav baseline */
    nav {
      background: var(--color-surface);
      border-bottom: 1px solid var(--color-border);
    }

    /* ‚îÄ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ */
    .app-shell {
      max-width: 720px;
      margin: 0 auto;
      padding: 0 16px 40px;
      position: relative;
    }

    /* ‚îÄ‚îÄ‚îÄ CHEAT SHEET BUTTON ‚îÄ‚îÄ‚îÄ */
    .cheatsheet-btn {
      margin: auto;
      margin-top: 20px;
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: 999px;
      color: var(--color-muted);
      padding: 6px 14px;
      font-size: .7rem;
      font-weight: 600;
      cursor: pointer;
      transition: all .2s;
      z-index: 10;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .cheatsheet-btn:hover {
      border-color: var(--color-accent);
      color: var(--color-accent);
      background: var(--color-card-hi);
    }

    /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
    .header {
      text-align: center;
      padding: 32px 0 8px;
    }

    .header h1 {
      font-family: 'Cinzel', serif;
      font-weight: 900;
      font-size: clamp(1.6rem, 5vw, 2.4rem);
      letter-spacing: .04em;
      background: linear-gradient(135deg, var(--ax-ciezar), var(--ax-prz), var(--ax-czas));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 4px;
    }

    .header p {
      color: var(--color-muted);
      font-size: .85rem;
      margin: 0;
    }

    /* ‚îÄ‚îÄ‚îÄ MODE TABS ‚îÄ‚îÄ‚îÄ */
    .mode-tabs {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .mode-tab {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: 999px;
      color: var(--color-muted);
      padding: 8px 20px;
      font-size: .82rem;
      font-weight: 600;
      letter-spacing: .06em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all .2s;
    }

    .mode-tab:hover {
      border-color: var(--color-accent);
      color: var(--color-text);
    }

    .mode-tab.active {
      background: var(--color-accent);
      border-color: var(--color-accent);
      color: #fff;
      box-shadow: 0 0 18px rgba(192, 132, 252, .35);
    }

    /* ‚îÄ‚îÄ‚îÄ QUIZ TYPE SELECTOR ‚îÄ‚îÄ‚îÄ */
    .quiz-type-selector {
      display: flex;
      gap: 6px;
      justify-content: center;
      margin: 10px 0 20px;
      flex-wrap: wrap;
    }

    .quiz-type-btn {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: 999px;
      color: var(--color-muted);
      padding: 6px 16px;
      font-size: .72rem;
      font-weight: 600;
      cursor: pointer;
      transition: all .15s;
    }

    .quiz-type-btn:hover {
      border-color: var(--color-accent);
      color: var(--color-text);
    }

    .quiz-type-btn.active {
      background: var(--color-accent);
      border-color: var(--color-accent);
      color: #fff;
    }

    /* ‚îÄ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ‚îÄ */
    .progress-wrap {
      margin: 12px 0 24px;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      font-size: .75rem;
      color: var(--color-muted);
      margin-bottom: 6px;
    }

    .progress-track {
      background: var(--color-card);
      border-radius: 999px;
      height: 6px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--ax-ciezar), var(--ax-prz));
      transition: width .4s ease;
    }

    /* ‚îÄ‚îÄ‚îÄ AXES LEGEND STRIP ‚îÄ‚îÄ‚îÄ */
    .axes-strip {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .axes-chip {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: 999px;
      padding: 4px 12px;
      font-size: .75rem;
      font-weight: 600;
    }

    .axes-chip .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    /* ‚îÄ‚îÄ‚îÄ FLASHCARD ‚îÄ‚îÄ‚îÄ */
    .flashcard-scene {
      perspective: 900px;
      height: 460px;
      margin-bottom: 16px;
    }

    .flashcard {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform .6s cubic-bezier(.4, 0, .2, 1);
      cursor: pointer;
    }

    .flashcard.flipped {
      transform: rotateY(180deg);
    }

    .flashcard-face {
      position: absolute;
      inset: 0;
      backface-visibility: hidden;
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      box-shadow: 0 8px 40px rgba(0, 0, 0, .4);
    }

    .flashcard-face.back {
      transform: rotateY(180deg);
      background: var(--color-card-hi);
    }

    .card-effort-name {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.8rem, 6vw, 2.6rem);
      font-weight: 700;
      color: var(--color-text);
      margin-bottom: 6px;
      text-align: center;
    }

    .card-code {
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: .18em;
      color: var(--color-muted);
      margin-bottom: 12px;
    }

    .card-code span {
      font-weight: 800;
    }

    .card-tap-hint {
      font-size: .72rem;
      color: var(--color-muted);
      margin-top: auto;
      letter-spacing: .08em;
      text-transform: uppercase;
      opacity: .6;
    }

    /* back face details */
    .card-axes-row {
      display: flex;
      gap: 10px;
      margin: 12px 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .card-axis-badge {
      display: flex;
      align-items: center;
      gap: 5px;
      background: rgba(255, 255, 255, .06);
      border-radius: 999px;
      padding: 4px 10px;
      font-size: .78rem;
      font-weight: 600;
    }

    .card-axis-badge .dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
    }

    .card-description {
      font-size: .88rem;
      color: var(--color-text);
      text-align: center;
      line-height: 1.55;
      max-width: 380px;
      margin: 8px 0;
    }

    .card-example {
      font-size: .78rem;
      color: var(--color-muted);
      font-style: italic;
      text-align: center;
      margin-top: 4px;
    }

    .card-rating-row {
      display: flex;
      gap: 8px;
      margin-top: 14px;
    }

    .card-rating-row button {
      border-radius: 999px;
      border: 1px solid var(--color-border);
      padding: 6px 18px;
      font-size: .78rem;
      font-weight: 600;
      cursor: pointer;
      background: var(--color-card);
      color: var(--color-text);
      transition: all .15s;
    }

    .card-rating-row button:hover {
      border-color: currentColor;
    }

    .btn-know {
      color: var(--color-green);
    }

    .btn-know:hover {
      background: rgba(74, 222, 128, .12);
    }

    .btn-dontknow {
      color: var(--color-red);
    }

    .btn-dontknow:hover {
      background: rgba(248, 113, 113, .12);
    }

    /* ‚îÄ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ‚îÄ */
    .quiz-question {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      padding: 28px 24px 20px;
      text-align: center;
      margin-bottom: 18px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, .3);
    }

    .quiz-q-label {
      font-size: .7rem;
      color: var(--color-muted);
      text-transform: uppercase;
      letter-spacing: .12em;
      margin-bottom: 10px;
    }

    .quiz-q-name {
      font-family: 'Cinzel', serif;
      font-size: 1.9rem;
      font-weight: 700;
      color: var(--color-text);
      margin: 0 0 4px;
    }

    .quiz-q-code {
      font-size: 1rem;
      letter-spacing: .2em;
      color: var(--color-muted);
      font-weight: 700;
      display: flex;
      justify-content: center;
      gap: 4px;
    }

    .quiz-q-code span {
      font-weight: 800;
      padding: 2px 6px;
      border-radius: 4px;
      background: rgba(255, 255, 255, .05);
    }

    .quiz-q-desc {
      font-size: .85rem;
      color: var(--color-text);
      line-height: 1.5;
      max-width: 460px;
      margin: 12px auto 0;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .quiz-option {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      padding: 14px 18px;
      cursor: pointer;
      transition: all .18s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .quiz-option:hover {
      border-color: var(--color-accent);
      background: var(--color-card-hi);
    }

    .quiz-option.correct {
      border-color: var(--color-green);
      background: rgba(74, 222, 128, .08);
    }

    .quiz-option.wrong {
      border-color: var(--color-red);
      background: rgba(248, 113, 113, .08);
    }

    .quiz-option.disabled {
      pointer-events: none;
    }

    .quiz-option .opt-letter {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--color-card-hi);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .78rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .quiz-option .opt-text {
      font-size: .85rem;
      line-height: 1.4;
    }

    .quiz-feedback {
      margin-top: 14px;
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      font-size: .82rem;
      line-height: 1.5;
      text-align: center;
    }

    .quiz-feedback.correct {
      background: rgba(74, 222, 128, .1);
      color: var(--color-green);
      border: 1px solid rgba(74, 222, 128, .25);
    }

    .quiz-feedback.wrong {
      background: rgba(248, 113, 113, .1);
      color: var(--color-red);
      border: 1px solid rgba(248, 113, 113, .25);
    }

    .quiz-next-btn {
      display: block;
      width: 100%;
      margin-top: 16px;
      background: var(--color-accent);
      border: none;
      color: #fff;
      border-radius: var(--radius-sm);
      padding: 12px;
      font-weight: 600;
      font-size: .88rem;
      cursor: pointer;
      transition: filter .15s;
    }

    .quiz-next-btn:hover {
      filter: brightness(1.15);
    }

    /* ‚îÄ‚îÄ‚îÄ GM MODE ‚îÄ‚îÄ‚îÄ */
    .gm-card {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: 0 8px 40px rgba(0, 0, 0, .4);
      margin-bottom: 16px;
    }

    .gm-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .gm-label {
      font-size: .7rem;
      color: var(--color-muted);
      text-transform: uppercase;
      letter-spacing: .12em;
    }

    .gm-reroll {
      background: none;
      border: 1px solid var(--color-border);
      color: var(--color-muted);
      border-radius: 999px;
      padding: 4px 14px;
      font-size: .72rem;
      font-weight: 600;
      cursor: pointer;
      transition: all .15s;
    }

    .gm-reroll:hover {
      border-color: var(--color-accent);
      color: var(--color-accent);
    }

    .gm-effort-row {
      text-align: center;
      margin-bottom: 18px;
    }

    .gm-effort-name {
      font-family: 'Cinzel', serif;
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .gm-effort-code {
      font-size: .9rem;
      letter-spacing: .18em;
      color: var(--color-muted);
      font-weight: 700;
    }

    .gm-modifiers {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .gm-mod-chip {
      background: rgba(255, 255, 255, .05);
      border: 1px solid var(--color-border);
      border-radius: 999px;
      padding: 5px 13px;
      font-size: .77rem;
      font-weight: 500;
      color: var(--color-text);
    }

    .gm-mod-chip .mod-cat {
      color: var(--color-muted);
      font-size: .68rem;
      text-transform: uppercase;
      letter-spacing: .06em;
      display: block;
      margin-bottom: 1px;
    }

    .gm-reveal-btn {
      display: block;
      width: 100%;
      background: linear-gradient(135deg, rgba(192, 132, 252, .25), rgba(96, 165, 250, .2));
      border: 1px solid var(--color-accent);
      color: var(--color-accent);
      border-radius: var(--radius-sm);
      padding: 13px;
      font-weight: 600;
      font-size: .88rem;
      cursor: pointer;
      transition: all .18s;
    }

    .gm-reveal-btn:hover {
      background: linear-gradient(135deg, rgba(192, 132, 252, .4), rgba(96, 165, 250, .3));
    }

    .gm-answer {
      margin-top: 18px;
      padding: 18px;
      background: var(--color-card-hi);
      border-radius: var(--radius-sm);
      border: 1px solid var(--color-border);
    }

    .gm-answer-title {
      font-size: .7rem;
      color: var(--color-accent);
      text-transform: uppercase;
      letter-spacing: .1em;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .gm-answer-text {
      font-size: .88rem;
      color: var(--color-text);
      line-height: 1.6;
    }

    .gm-answer-axes {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .gm-answer-axis {
      font-size: .72rem;
      font-weight: 600;
    }

    /* ‚îÄ‚îÄ‚îÄ CUBE MINI-MAP ‚îÄ‚îÄ‚îÄ */
    .cube-mini {
      margin: 0 auto 20px;
      width: 160px;
      height: 160px;
      perspective: 500px;
    }

    .cube-mini-inner {
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transform: rotateX(25deg) rotateY(-35deg);
      position: relative;
    }

    .cube-face {
      position: absolute;
      width: 100%;
      height: 100%;
      border: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .62rem;
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: var(--color-muted);
      backface-visibility: visible;
      opacity: .25;
      transition: opacity .3s;
    }

    .cube-face.lit {
      opacity: .7;
      color: var(--color-text);
    }

    .cube-face.front {
      transform: translateZ(80px);
      background: rgba(192, 132, 252, .06);
    }

    .cube-face.back2 {
      transform: rotateY(180deg) translateZ(80px);
      background: rgba(192, 132, 252, .06);
    }

    .cube-face.right {
      transform: rotateY(90deg) translateZ(80px);
      background: rgba(96, 165, 250, .06);
    }

    .cube-face.left {
      transform: rotateY(-90deg) translateZ(80px);
      background: rgba(96, 165, 250, .06);
    }

    .cube-face.top {
      transform: rotateX(90deg) translateZ(80px);
      background: rgba(244, 114, 182, .06);
    }

    .cube-face.bottom {
      transform: rotateX(-90deg) translateZ(80px);
      background: rgba(244, 114, 182, .06);
    }

    /* Dodatkowe style dla lepszej wizualizacji */
    /* front - fiolet */
    .cube-face:nth-child(1) {
      border-color: rgba(192, 132, 252, 0.3);
    }

    /* back - fiolet */
    .cube-face:nth-child(2) {
      border-color: rgba(192, 132, 252, 0.3);
    }

    /* right - niebieski */
    .cube-face:nth-child(3) {
      border-color: rgba(96, 165, 250, 0.3);
    }

    /* left - niebieski */
    .cube-face:nth-child(4) {
      border-color: rgba(96, 165, 250, 0.3);
    }

    /* top - r√≥≈º */
    .cube-face:nth-child(5) {
      border-color: rgba(244, 114, 182, 0.3);
    }

    /* bottom - r√≥≈º */
    .cube-face:nth-child(6) {
      border-color: rgba(244, 114, 182, 0.3);
    }

    .cube-face.lit {
      opacity: 0.9;
    }

    /* ‚îÄ‚îÄ‚îÄ SCORE RIBBON ‚îÄ‚îÄ‚îÄ */
    .score-ribbon {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }

    .score-item {
      text-align: center;
    }

    .score-num {
      font-family: 'Cinzel', serif;
      font-size: 1.4rem;
      font-weight: 700;
    }

    .score-num.green {
      color: var(--color-green);
    }

    .score-num.red {
      color: var(--color-red);
    }

    .score-num.gold {
      color: var(--color-gold);
    }

    .score-lbl {
      font-size: .68rem;
      color: var(--color-muted);
      text-transform: uppercase;
      letter-spacing: .08em;
    }

    /* ‚îÄ‚îÄ‚îÄ UTILITY ‚îÄ‚îÄ‚îÄ */
    .text-center {
      text-align: center;
    }

    .mt-0 {
      margin-top: 0 !important;
    }

    [x-cloak] {
      display: none !important;
    }

    /* ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      animation: fadeIn 0.2s ease-out;
    }

    .modal-container {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
      max-width: 90vw;
      max-height: 90vh;
      width: 500px;
      overflow: hidden;
      animation: slideUp 0.3s ease-out;
      position: relative;
    }

    .modal-header {
      padding: 1.2rem 1.5rem;
      border-bottom: 1px solid var(--color-border);
      background: var(--color-card-hi);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-family: 'Cinzel', serif;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--color-text);
      margin: 0;
    }

    .modal-close {
      background: transparent;
      border: none;
      color: var(--color-muted);
      font-size: 1.5rem;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
      line-height: 1;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--color-text);
    }

    .modal-content {
      padding: 1.5rem;
      overflow-y: auto;
      max-height: 70vh;
    }

    .modal-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--color-border);
      background: var(--color-card-hi);
      text-align: center;
    }

    .modal-image-container {
      text-align: center;
      margin-bottom: 1rem;
    }

    .modal-image {
      max-width: 100%;
      height: auto;
      border-radius: var(--radius-sm);
      border: 1px solid var(--color-border);
      cursor: zoom-in;
      transition: transform 0.3s ease;
    }

    .modal-image-zoomed {
      max-height: 85vh;
      /* Ogranicza wysoko≈õƒá */
      max-width: 90vw;
      /* Ogranicza szeroko≈õƒá */
      width: auto;
      /* Zachowuje proporcje */
      cursor: zoom-out;
      /* Zmienia kursor */
      object-fit: contain;
      /* Zapewnia, ≈ºe ca≈Çy obraz bƒôdzie widoczny */
    }

    .modal-image-hint {
      font-size: 0.8rem;
      color: var(--color-muted);
      margin-top: 0.5rem;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--color-bg);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--color-border);
      border-radius: 3px;
    }

    /* ‚îÄ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ‚îÄ */
    @keyframes pop-in {
      0% {
        transform: scale(.88);
        opacity: 0
      }

      60% {
        transform: scale(1.03)
      }

      100% {
        transform: scale(1);
        opacity: 1
      }
    }

    .pop-in {
      animation: pop-in .28s cubic-bezier(.4, 0, .2, 1) both;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0)
      }

      25% {
        transform: translateX(-6px)
      }

      75% {
        transform: translateX(6px)
      }
    }

    .shake {
      animation: shake .35s ease;
    }
  </style>
</head>

<body>

  <div class="app-shell" x-data="labana()" x-cloak x-init="init()">

    <!-- HEADER -->
    <div class="header">
      <h1>Wysi≈Çki Labana</h1>
      <p>Trening g≈Çosu postaci</p>
    </div>

    <!-- AXES LEGEND -->
    <div class="axes-strip">
      <div class="axes-chip"><span class="dot" style="background:var(--ax-ciezar)"></span> Ciƒô≈ºar: Stanowczy / Delikatny
      </div>
      <div class="axes-chip"><span class="dot" style="background:var(--ax-czas)"></span> Czas: Nag≈Çy / Trwa≈Çy</div>
      <div class="axes-chip"><span class="dot" style="background:var(--ax-prz)"></span> Przestrze≈Ñ: Bezpo≈õredni /
        Po≈õredni</div>
    </div>

    <!-- MODE TABS -->
    <div class="mode-tabs">
      <button class="mode-tab" :class="{active: mode==='flash'}" @click="switchMode('flash')">üìö Nauka</button>
      <button class="mode-tab" :class="{active: mode==='quiz'}" @click="switchMode('quiz')">üéØ Quiz</button>
      <button class="mode-tab" :class="{active: mode==='gm'}" @click="switchMode('gm')">üé≠ Generuj Postaƒá</button>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MODE: NAUKA (FLASHCARDS)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div x-show="mode === 'flash'">

      <!-- progress -->
      <div class="progress-wrap">
        <div class="progress-label">
          <span>Postƒôp</span>
          <span x-text="flashQueue.length === 0 ? 'Gotowe!' : (flashIndex+1) + ' / ' + flashQueue.length"></span>
        </div>
        <div class="progress-track">
          <div class="progress-fill"
            :style="`width: ${flashQueue.length ? ((flashIndex)/flashQueue.length*100) : 100}%`"></div>
        </div>
      </div>

      <!-- scores -->
      <div class="score-ribbon">
        <div class="score-item">
          <div class="score-num green" x-text="flashScore.know"></div>
          <div class="score-lbl">Znam</div>
        </div>
        <div class="score-item">
          <div class="score-num red" x-text="flashScore.dontknow"></div>
          <div class="score-lbl">Nie znam</div>
        </div>
        <div class="score-item">
          <div class="score-num gold" x-text="flashScore.streak"></div>
          <div class="score-lbl">Seriƒô</div>
        </div>
      </div>

      <!-- CARD or DONE message -->
      <template x-if="flashQueue.length > 0">
        <div>
          <!-- 3D Flashcard -->
          <div class="flashcard-scene">
            <div class="flashcard" :class="{flipped: flashFlipped}" @click="flashFlipped = !flashFlipped"
              :key="flashIndex">
              <!-- FRONT -->
              <div class="flashcard-face front">
                <div class="card-effort-name" x-text="currentFlash().name"></div>
                <div class="card-code">
                  <span :style="`color:var(--ax-ciezar)`" x-text="currentFlash().code[0]"></span><!--
                --><span :style="`color:var(--ax-czas)`" x-text="currentFlash().code[1]"></span><!--
                --><span :style="`color:var(--ax-prz)`" x-text="currentFlash().code[2]"></span>
                </div>
                <!-- mini cube -->
                <div class="cube-mini">
                  <div class="cube-mini-inner">
                    <div class="cube-face front" :class="{lit: currentFlash().prz==='B'}">
                      <div class="cube-face-content">Bezpo≈õredni</div>
                    </div>
                    <div class="cube-face back2" :class="{lit: currentFlash().prz==='P'}">
                      <div class="cube-face-content">Po≈õredni</div>
                    </div>
                    <div class="right cube-face" :class="{lit: currentFlash().czas==='N'}">
                      <div class="cube-face-content">Nag≈Çy</div>
                    </div>
                    <div class="left cube-face" :class="{lit: currentFlash().czas==='T'}">
                      <div class="cube-face-content">Trwa≈Çy</div>
                    </div>
                    <div class="top cube-face" :class="{lit: currentFlash().ciezar==='S'}">
                      <div class="cube-face-content">Stanowczy</div>
                    </div>
                    <div class="bottom cube-face" :class="{lit: currentFlash().ciezar==='D'}">
                      <div class="cube-face-content">Delikatny</div>
                    </div>
                  </div>
                </div>
                <div class="card-tap-hint">Dotknij, ≈ºeby ods≈Çoniƒá ‚ñº</div>
              </div>
              <!-- BACK -->
              <div class="flashcard-face back">
                <div class="card-effort-name" x-text="currentFlash().name" style="font-size:1.6rem;"></div>
                <div class="card-axes-row">
                  <div class="card-axis-badge">
                    <span class="dot" style="background:var(--ax-ciezar)"></span>
                    <span x-text="currentFlash().ciezar === 'S' ? 'Stanowczy' : 'Delikatny'"></span>
                  </div>
                  <div class="card-axis-badge">
                    <span class="dot" style="background:var(--ax-czas)"></span>
                    <span x-text="currentFlash().czas === 'N' ? 'Nag≈Çy' : 'Trwa≈Çy'"></span>
                  </div>
                  <div class="card-axis-badge">
                    <span class="dot" style="background:var(--ax-prz)"></span>
                    <span x-text="currentFlash().prz === 'B' ? 'Bezpo≈õredni' : 'Po≈õredni'"></span>
                  </div>
                </div>
                <div class="card-description" x-text="currentFlash().desc"></div>
                <div class="card-example" x-text="'Przyk≈Çad: ' + currentFlash().example"></div>
                <div class="card-rating-row">
                  <button class="btn-dontknow" @click.stop="rateFlash(false)">‚úó Nie znam</button>
                  <button class="btn-know" @click.stop="rateFlash(true)">‚úì Znam</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </template>

      <!-- DONE state -->
      <template x-if="flashQueue.length === 0">
        <div class="text-center gm-card" style="padding:40px 24px;">
          <div style="font-size:2.4rem; margin-bottom:10px;">üéâ</div>
          <div
            style="font-family:'Cinzel',serif; font-size:1.3rem; font-weight:700; margin-bottom:8px; color:var(--color-green);">
            Rundƒô uko≈Ñczono!</div>
          <div style="font-size:.83rem; color:var(--color-muted); margin-bottom:20px;"
            x-text="`Znam: ${flashScore.know}  |  Nie znam: ${flashScore.dontknow}  |  Najd≈Çu≈ºsza seria: ${flashScore.streak}`">
          </div>
          <button class="quiz-next-btn" style="max-width:260px; margin:0 auto;" @click="resetFlash()">Powt√≥rz</button>
        </div>
      </template>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MODE: QUIZ
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div x-show="mode === 'quiz'">

      <!-- quiz type selector -->
      <div class="quiz-type-selector">
        <button class="quiz-type-btn" :class="{active: quizType === 'name-to-code'}"
          @click="quizType = 'name-to-code'; nextQuiz();">
          Nazwa ‚Üí Kod
        </button>
        <button class="quiz-type-btn" :class="{active: quizType === 'code-to-name'}"
          @click="quizType = 'code-to-name'; nextQuiz();">
          Kod ‚Üí Nazwa
        </button>
        <button class="quiz-type-btn" :class="{active: quizType === 'name-to-desc'}"
          @click="quizType = 'name-to-desc'; nextQuiz();">
          Nazwa ‚Üí Opis
        </button>
        <button class="quiz-type-btn" :class="{active: quizType === 'desc-to-name'}"
          @click="quizType = 'desc-to-name'; nextQuiz();">
          Opis ‚Üí Nazwa
        </button>
      </div>

      <!-- scores -->
      <div class="score-ribbon">
        <div class="score-item">
          <div class="score-num green" x-text="quizScore.correct"></div>
          <div class="score-lbl">Poprawne</div>
        </div>
        <div class="score-item">
          <div class="score-num red" x-text="quizScore.wrong"></div>
          <div class="score-lbl">B≈Çƒôdne</div>
        </div>
        <div class="score-item">
          <div class="score-num gold" x-text="quizScore.streak"></div>
          <div class="score-lbl">Seriƒô</div>
        </div>
      </div>

      <!-- question card - dynamic based on quiz type -->
      <div class="quiz-question">
        <div class="quiz-q-label" x-text="quizTypeLabel"></div>

        <!-- Nazwa ‚Üí Kod: show only name -->
        <template x-if="quizType === 'name-to-code'">
          <div>
            <div class="quiz-q-name" x-text="quizQ.name"></div>
          </div>
        </template>

        <!-- Kod ‚Üí Nazwa: show only code -->
        <template x-if="quizType === 'code-to-name'">
          <div>
            <div class="quiz-q-code">
              <span :style="`color:var(--ax-ciezar)`" x-text="quizQ.code[0]"></span>
              <span :style="`color:var(--ax-czas)`" x-text="quizQ.code[1]"></span>
              <span :style="`color:var(--ax-prz)`" x-text="quizQ.code[2]"></span>
            </div>
          </div>
        </template>

        <!-- Nazwa ‚Üí Opis: show only name -->
        <template x-if="quizType === 'name-to-desc'">
          <div>
            <div class="quiz-q-name" x-text="quizQ.name"></div>
          </div>
        </template>

        <!-- Opis ‚Üí Nazwa: show only description -->
        <template x-if="quizType === 'desc-to-name'">
          <div>
            <div class="quiz-q-desc" x-text="quizQ.desc"></div>
          </div>
        </template>
      </div>

      <!-- options -->
      <div class="quiz-options">
        <template x-for="(opt, idx) in quizOptions" :key="idx">
          <div class="quiz-option" :class="{
               correct:  quizAnswered && opt.isCorrect,
               wrong:    quizAnswered && quizPicked === idx && !opt.isCorrect,
               disabled: quizAnswered
             }" @click="answerQuiz(idx)">
            <div class="opt-letter" x-text="['A','B','C','D'][idx]"></div>
            <div class="opt-text">
              <!-- For name-to-code: show codes -->
              <template x-if="quizType === 'name-to-code'">
                <span>
                  <span :style="`color:var(--ax-ciezar); font-weight:700;`" x-text="opt.code[0]"></span>
                  <span :style="`color:var(--ax-czas); font-weight:700;`" x-text="opt.code[1]"></span>
                  <span :style="`color:var(--ax-prz); font-weight:700;`" x-text="opt.code[2]"></span>
                </span>
              </template>

              <!-- For code-to-name: show names -->
              <template x-if="quizType === 'code-to-name'">
                <span x-text="opt.name" style="font-weight: 600;"></span>
              </template>

              <!-- For name-to-desc: show descriptions -->
              <template x-if="quizType === 'name-to-desc'">
                <span x-text="opt.desc"></span>
              </template>

              <!-- For desc-to-name: show names -->
              <template x-if="quizType === 'desc-to-name'">
                <span x-text="opt.name" style="font-weight: 600;"></span>
              </template>
            </div>
          </div>
        </template>
      </div>

      <!-- feedback -->
      <div x-show="quizAnswered" class="quiz-feedback" :class="{correct: quizCorrect, wrong: !quizCorrect}">
        <template x-if="quizCorrect">
          <span>‚úì Dobrze!</span>
        </template>
        <template x-if="!quizCorrect">
          <span>‚úó ≈πle.
            <template x-if="quizType === 'name-to-code'">
              <span><strong x-text="quizQ.name"></strong> to <strong x-text="quizQ.code"></strong>: <span
                  x-text="quizQ.desc"></span></span>
            </template>
            <template x-if="quizType === 'code-to-name'">
              <span><strong x-text="quizQ.code"></strong> to <strong x-text="quizQ.name"></strong>: <span
                  x-text="quizQ.desc"></span></span>
            </template>
            <template x-if="quizType === 'name-to-desc'">
              <span><strong x-text="quizQ.name"></strong>: <span x-text="quizQ.desc"></span></span>
            </template>
            <template x-if="quizType === 'desc-to-name'">
              <span><span x-text="quizQ.desc"></span> to <strong x-text="quizQ.name"></strong> (<span
                  x-text="quizQ.code"></span>)</span>
            </template>
          </span>
        </template>
      </div>

      <!-- next -->
      <button x-show="quizAnswered" class="quiz-next-btn" @click="nextQuiz()">Nastƒôpne ‚Üí</button>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MODE: GM MODE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div x-show="mode === 'gm'">

      <div class="gm-card">
        <div class="gm-header">
          <span class="gm-label">üé≠ Losowa Postaƒá</span>
          <button class="gm-reroll" @click="rollGM()">‚Üª Nowa postaƒá</button>
        </div>

        <!-- effort -->
        <div class="gm-effort-row">
          <div class="gm-effort-name" x-text="gmCombo.effort.name"></div>
          <div class="gm-effort-code">
            <span :style="`color:var(--ax-ciezar)`" x-text="gmCombo.effort.code[0]"></span><!--
          --><span :style="`color:var(--ax-czas)`" x-text="gmCombo.effort.code[1]"></span><!--
          --><span :style="`color:var(--ax-prz)`" x-text="gmCombo.effort.code[2]"></span>
          </div>
        </div>

        <!-- modifiers -->
        <div class="gm-modifiers">
          <template x-for="mod in gmCombo.mods" :key="mod.cat">
            <div class="gm-mod-chip">
              <span class="mod-cat" x-text="mod.cat"></span>
              <span x-text="mod.val"></span>
            </div>
          </template>
        </div>

        <!-- reveal / answer
        <button x-show="!gmRevealed" class="gm-reveal-btn" @click="gmRevealed = true">
          Skompiluj opis g≈Çosu ‚Üí
        </button> -->

        <div class="gm-answer">
          <div class="gm-answer-title">Opis g≈Çosu</div>
          <div class="gm-answer-text" x-text="gmAnswer"></div>
          <div class="gm-answer-axes">
            <span class="gm-answer-axis" style="color:var(--ax-ciezar);"
              x-text="gmCombo.effort.ciezar==='S' ? '‚ñ≤ Stanowczy' : '‚ñΩ Delikatny'"></span>
            <span class="gm-answer-axis" style="color:var(--ax-czas);"
              x-text="gmCombo.effort.czas==='N' ? '‚ö° Nag≈Çy' : '„Ä∞ Trwa≈Çy'"></span>
            <span class="gm-answer-axis" style="color:var(--ax-prz);"
              x-text="gmCombo.effort.prz==='B' ? '‚Üí Bezpo≈õredni' : '„Ä∞ Po≈õredni'"></span>
          </div>
        </div>
      </div>

      <!-- quick cheat sheet -->
      <details>
        <summary style="font-size:.8rem; color:var(--color-muted); cursor:pointer;">≈öciƒÖga ‚Äî wszystkie 8 wysi≈Çk√≥w
        </summary>
        <div style="margin-top:10px; display:grid; grid-template-columns:1fr 1fr; gap:8px;">
          <template x-for="e in efforts" :key="e.code">
            <div
              style="background:var(--color-card-hi); border:1px solid var(--color-border); border-radius:var(--radius-sm); padding:10px 12px;">
              <div style="font-family:'Cinzel',serif; font-weight:700; font-size:.88rem;" x-text="e.name"></div>
              <div style="font-size:.72rem; letter-spacing:.14em; margin:2px 0 4px;">
                <span :style="`color:var(--ax-ciezar)`" x-text="e.code[0]"></span><!--
              --><span :style="`color:var(--ax-czas)`" x-text="e.code[1]"></span><!--
              --><span :style="`color:var(--ax-prz)`" x-text="e.code[2]"></span>
              </div>
              <div style="font-size:.72rem; color:var(--color-muted);" x-text="e.desc"></div>
            </div>
          </template>
        </div>
      </details>
    </div>

    <!-- CHEAT SHEET BUTTON -->
    <button class="cheatsheet-btn" @click="modalOpen = true">
      üìã ≈öciƒÖga
    </button>

    <!-- MODAL FOR CHEAT SHEET -->
    <div x-show="modalOpen" class="modal-overlay" @click.self="modalOpen = false">
      <div class="modal-container">
        <div class="modal-header">
          <h3 class="modal-title">≈öciƒÖga ‚Äî Wysi≈Çki Labana</h3>
          <button class="modal-close" @click="modalOpen = false">√ó</button>
        </div>

        <div class="modal-content">
          <div class="modal-image-container">
            <img id="cheatsheet-img" src="https://i.imgur.com/9rrlYF8.png" alt="Schemat wysi≈Çk√≥w Labana"
              class="modal-image" :class="{'modal-image-zoomed': imageZoomed}" @click="imageZoomed = !imageZoomed">
            <p style="font-size: 0.8rem; color: var(--color-muted); margin-top: 1rem;">
              Kliknij obrazek, ≈ºeby przybli≈ºyƒá/oddaliƒá.
            </p>
          </div>
        </div>

        <div class="modal-footer">
          <button @click="modalOpen = false">Zamknij</button>
        </div>
      </div>
    </div>

  </div><!-- /app-shell -->

  <script>
    // ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function labana() {
      return {
        // ‚îÄ‚îÄ mode ‚îÄ‚îÄ
        mode: 'flash',

        // ‚îÄ‚îÄ modal state ‚îÄ‚îÄ
        modalOpen: false,
        imageZoomed: false,

        // ‚îÄ‚îÄ quiz type ‚îÄ‚îÄ
        quizType: 'name-to-code',
        quizTypeLabel: 'Wybierz kod tego wysi≈Çku',

        // ‚îÄ‚îÄ efforts ‚îÄ‚îÄ
        efforts: [
          {
            name: 'UderzajƒÖcy', code: 'SNB', ciezar: 'S', czas: 'N', prz: 'B',
            desc: 'Silny, nag≈Çy i bezpo≈õredni. Zaanga≈ºuj mocny wydech wspierany miƒô≈õniami brzucha. Krta≈Ñ kr√≥tkotrwale siƒô zaciska. D≈∫wiƒôk jest jak precyzyjne uderzenie.',
            example: 'Stanowczy rozkaz, gniewny okrzyk "Nie!", zdecydowane has≈Ço.'
          },
          {
            name: 'TrzepiƒÖcy', code: 'DNP', ciezar: 'D', czas: 'N', prz: 'P',
            desc: 'Lekki, nag≈Çy i po≈õredni. D≈∫wiƒôk jest "rzucany" lub "strzepywany" bez ciƒô≈ºaru. Powietrze ulatnia siƒô swobodnie, prawie bez oporu w krtani.',
            example: 'Sarkastyczna uwaga rzucona w powietrze, nerwowy ≈õmiech, lekcewa≈ºƒÖcy komentarz.'
          },
          {
            name: 'NaciskajƒÖcy', code: 'STB', ciezar: 'S', czas: 'T', prz: 'B',
            desc: 'Silny, ciƒÖg≈Çy i bezpo≈õredni. Utrzymuj sta≈Çy nacisk na struny g≈Çosowe i kontrolowany wydech. D≈∫wiƒôk jest gƒôsty, intensywny i uporczywie ukierunkowany.',
            example: 'Powolna gro≈∫ba, dobitne czytanie wyroku, m√≥wienie przez zaci≈õniƒôte zƒôby w gniewie.'
          },
          {
            name: 'DotykajƒÖcy', code: 'DNB', ciezar: 'D', czas: 'N', prz: 'B',
            desc: 'Lekki, nag≈Çy i bezpo≈õredni. Kr√≥tkie, precyzyjne "pchniƒôcia" d≈∫wiƒôkiem. Ka≈ºda sylaba jest oddzielona i wyra≈∫na, jak punktowy dotyk.',
            example: 'Szeptane wyznanie, dyktowanie numeru telefonu.'
          },
          {
            name: 'SunƒÖcy', code: 'DTB', ciezar: 'D', czas: 'T', prz: 'B',
            desc: 'Lekki, ciƒÖg≈Çy i bezpo≈õredni. P≈Çynny, nieprzerwany strumie≈Ñ d≈∫wiƒôku ≈Çagodnie prowadzony do przodu. Oddech spokojny, krta≈Ñ rozlu≈∫niona.',
            example: 'Spokojny narrator audiobooka, ≈Çagodne pocieszanie, melodyjne opowiadanie historii.'
          },
          {
            name: 'UnoszƒÖcy', code: 'DTP', ciezar: 'D', czas: 'T', prz: 'P',
            desc: 'Lekki, ciƒÖg≈Çy i po≈õredni. D≈∫wiƒôk "unosi siƒô" lub "dryfuje" bez wyra≈∫nego kierunku. Minimalne napiƒôcie strun, barwa eteryczna i rozmyta.',
            example: 'Marzycielskie m√≥wienie do siebie, g≈Ços w transie, delikatne nucenie.'
          },
          {
            name: 'WykrƒôcajƒÖcy', code: 'SNP', ciezar: 'S', czas: 'N', prz: 'P',
            desc: 'Silny, nag≈Çy i po≈õredni. Ostry, szarpiƒÖcy wysi≈Çek rozlewajƒÖcy siƒô na boki. Intensywny, ale pozbawiony precyzyjnego skupienia.',
            example: 'Szyderczy ≈õmiech, histeryczny krzyk, nag≈Çy wybuch frustracji.'
          },
          {
            name: 'TnƒÖcy', code: 'STP', ciezar: 'S', czas: 'T', prz: 'P',
            desc: 'Silny, ciƒÖg≈Çy i po≈õredni. Sta≈Çe napiƒôcie z wewnƒôtrznym oporem i "skrƒôceniem". D≈∫wiƒôk jest "wy≈ºymany" z trudem, z poczuciem cierpienia.',
            example: 'G≈Ços t≈ÇumiƒÖcy p≈Çacz, m√≥wienie przez b√≥l, monolog pe≈Çen wewnƒôtrznej agonii.'
          },
        ],

        // ‚îÄ‚îÄ modifiers pool ‚îÄ‚îÄ
        modPool: {
          'Tekstura': ['Sucha', 'OddychajƒÖca'],
          'Po≈Ço≈ºenie': ['Normalne', 'Nosowe', 'Gard≈Çowe'],
          'Tempo': ['≈örednie', 'Powolne', 'Szybkie'],
          'G≈Ço≈õno≈õƒá': ['≈öredni', 'Cichy', 'G≈Ço≈õny'],
          'Ton': ['Bezstronny', 'Przyjazny', 'Agresywny'],
          'Akcent': ['Brak', 'Obecny'],
          'Problemy': ['Brak', 'Seplenienie', 'Reranie', 'JƒÖkanie'],
          'Wiek': ['≈öredni', 'M≈Çody', 'Stary'],
          'P≈Çeƒá': ['Mƒô≈ºczyzna', 'Kobieta'],
          'Wielko≈õƒá': ['≈öredni', 'Ma≈Çy', 'Wielki'],
        },

        // ‚îÄ‚îÄ flashcard state ‚îÄ‚îÄ
        flashQueue: [],
        flashIndex: 0,
        flashFlipped: false,
        flashScore: { know: 0, dontknow: 0, streak: 0, bestStreak: 0 },

        // ‚îÄ‚îÄ quiz state ‚îÄ‚îÄ
        quizQ: {},
        quizOptions: [],
        quizAnswered: false,
        quizPicked: -1,
        quizCorrect: false,
        quizScore: { correct: 0, wrong: 0, streak: 0, bestStreak: 0 },

        // ‚îÄ‚îÄ GM state ‚îÄ‚îÄ
        gmCombo: { effort: {}, mods: [] },
        gmRevealed: false,
        gmAnswer: '',

        // ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        init() {
          this.resetFlash();
          this.nextQuiz();
          this.rollGM();
        },

        switchMode(m) {
          this.mode = m;
        },

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // FLASHCARDS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        resetFlash() {
          this.flashQueue = this.shuffle([...this.efforts]);
          this.flashIndex = 0;
          this.flashFlipped = false;
          this.flashScore = { know: 0, dontknow: 0, streak: 0, bestStreak: 0 };
        },

        currentFlash() {
          return this.flashQueue[this.flashIndex] || this.efforts[0];
        },

        rateFlash(knows) {
          if (knows) {
            this.flashScore.know++;
            this.flashScore.streak++;
            if (this.flashScore.streak > this.flashScore.bestStreak)
              this.flashScore.bestStreak = this.flashScore.streak;
          } else {
            this.flashScore.dontknow++;
            this.flashScore.streak = 0;
            // put it back in queue (near end) so it repeats
            const card = this.flashQueue[this.flashIndex];
            const remaining = this.flashQueue.slice(this.flashIndex + 1);
            const insertAt = Math.max(0, remaining.length - 2);
            remaining.splice(insertAt, 0, card);
            this.flashQueue = [...this.flashQueue.slice(0, this.flashIndex + 1), ...remaining];
          }
          this.flashIndex++;
          this.flashFlipped = false;
        },

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // QUIZ
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        nextQuiz() {
          this.quizAnswered = false;
          this.quizPicked = -1;
          this.quizCorrect = false;

          // Update label based on quiz type
          switch (this.quizType) {
            case 'name-to-code': this.quizTypeLabel = 'Wybierz kod tego wysi≈Çku'; break;
            case 'code-to-name': this.quizTypeLabel = 'Wybierz nazwƒô tego kodu'; break;
            case 'name-to-desc': this.quizTypeLabel = 'Wybierz opis tego wysi≈Çku'; break;
            case 'desc-to-name': this.quizTypeLabel = 'Wybierz nazwƒô tego opisu'; break;
          }

          // pick a random correct effort
          this.quizQ = this.pick(this.efforts);

          // build options based on quiz type
          const wrong = this.efforts.filter(e => e.code !== this.quizQ.code);
          const chosen = this.shuffle(wrong).slice(0, 3);

          let options = [];
          if (this.quizType === 'name-to-code') {
            options = this.shuffle([
              { ...this.quizQ, isCorrect: true },
              ...chosen.map(e => ({ ...e, isCorrect: false }))
            ]);
          } else if (this.quizType === 'code-to-name') {
            options = this.shuffle([
              { ...this.quizQ, isCorrect: true },
              ...chosen.map(e => ({ ...e, isCorrect: false }))
            ]);
          } else if (this.quizType === 'name-to-desc') {
            options = this.shuffle([
              { ...this.quizQ, isCorrect: true },
              ...chosen.map(e => ({ ...e, isCorrect: false }))
            ]);
          } else if (this.quizType === 'desc-to-name') {
            options = this.shuffle([
              { ...this.quizQ, isCorrect: true },
              ...chosen.map(e => ({ ...e, isCorrect: false }))
            ]);
          }

          this.quizOptions = options;
        },

        answerQuiz(idx) {
          if (this.quizAnswered) return;
          this.quizAnswered = true;
          this.quizPicked = idx;
          this.quizCorrect = this.quizOptions[idx].isCorrect;
          if (this.quizCorrect) {
            this.quizScore.correct++;
            this.quizScore.streak++;
            if (this.quizScore.streak > this.quizScore.bestStreak)
              this.quizScore.bestStreak = this.quizScore.streak;
          } else {
            this.quizScore.wrong++;
            this.quizScore.streak = 0;
          }
        },

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // GM MODE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        rollGM() {
          this.gmRevealed = false;
          this.gmAnswer = '';

          const effort = this.pick(this.efforts);

          // pick a random subset of modifiers (3-6 mods), always include P≈Çeƒá + Wiek
          const cats = Object.keys(this.modPool);
          const forced = ['P≈Çeƒá', 'Wiek', 'Wielko≈õƒá'];
          const optional = cats.filter(c => !forced.includes(c));
          const extraCount = 2 + Math.floor(Math.random() * 3); // 2-4 extra
          const extraCats = this.shuffle(optional).slice(0, extraCount);
          const allCats = [...forced, ...extraCats];

          const mods = allCats.map(cat => ({
            cat: cat,
            val: this.pick(this.modPool[cat])
          }));

          this.gmCombo = { effort, mods };

          // build answer text
          this.gmAnswer = this.buildGMAnswer(effort, mods);
        },

        buildGMAnswer(effort, mods) {
          const modMap = {};
          mods.forEach(m => { modMap[m.cat] = m.val; });

          let parts = [];

          // Start from effort base
          parts.push(effort.desc);

          // layer modifiers into description
          const plyc = modMap['P≈Çeƒá'] || 'Mƒô≈ºczyzna';
          const wiek = modMap['Wiek'] || '≈öredni';
          const wielko≈õƒá = modMap['Wielko≈õƒá'] || '≈öredni';
          const tekstura = modMap['Tekstura'];
          const po≈Ço≈ºenie = modMap['Po≈Ço≈ºenie'];
          const tempo = modMap['Tempo'];
          const g≈Ço≈õno≈õƒá = modMap['G≈Ço≈õno≈õƒá'];
          const ton = modMap['Ton'];
          const akcent = modMap['Akcent'];
          const problemy = modMap['Problemy'];

          let persona = '';
          if (wielko≈õƒá === 'Ma≈Çy') persona = (plyc === 'Kobieta' ? 'Drobna kobieta' : 'Drobny mƒô≈ºczyzna');
          else if (wielko≈õƒá === 'Wielki') persona = (plyc === 'Kobieta' ? 'Solidna kobieta' : 'Solidny mƒô≈ºczyzna');
          else persona = (plyc === 'Kobieta' ? 'Kobieta' : 'Mƒô≈ºczyzna');

          if (wiek === 'M≈Çody') persona += ' m≈Çoda';
          else if (wiek === 'Stary') persona += ' stara';

          parts.push(persona + '.');

          let extra = [];
          if (tekstura === 'Sucha') extra.push('G≈Ços suchy, bez wilgoci');
          if (tekstura === 'OddychajƒÖca') extra.push('G≈Ços oddychajƒÖcy, ciep≈Çy');
          if (po≈Ço≈ºenie === 'Nosowe') extra.push('z rezonansem nosowym');
          if (po≈Ço≈ºenie === 'Gard≈Çowe') extra.push('g≈Çƒôbokim, gard≈Çowym');
          if (tempo === 'Powolne') extra.push('m√≥wi powoli');
          if (tempo === 'Szybkie') extra.push('m√≥wi szybko');
          if (g≈Ço≈õno≈õƒá === 'Cichy') extra.push('bardzo cicho');
          if (g≈Ço≈õno≈õƒá === 'G≈Ço≈õny') extra.push('g≈Ço≈õno i wyra≈∫nie');
          if (ton === 'Przyjazny') extra.push('w przyjaznym tonie');
          if (ton === 'Agresywny') extra.push('w agresywnym, ostrym tonie');
          if (akcent === 'Obecny') extra.push('z wyra≈∫nym akcentem');
          if (problemy === 'Seplenienie') extra.push('sepleni');
          if (problemy === 'Reranie') extra.push('rere');
          if (problemy === 'JƒÖkanie') extra.push('jƒÖka siƒô');

          if (extra.length) parts.push(extra.join(', ') + '.');

          return parts.join(' ');
        },

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // HELPERS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        shuffle(arr) {
          const a = [...arr];
          for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
          }
          return a;
        },

        pick(arr) {
          return arr[Math.floor(Math.random() * arr.length)];
        }
      };
    }
  </script>
</body>

</html>